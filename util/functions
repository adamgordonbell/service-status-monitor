#! /bin/bash
# shellcheck disable=SC2207 # Arrays are a pain in bash 3

echo "functions assume they are run from repo root"
echo "run \"list\" for a list of helpers"

INIT_LOCATION="$0"

## External

run() { # Feedback
   sudo uv run scripts/app_server.py
}

run_no_sniff() { # Run without packet sniffing (no sudo required)
   uv run python scripts/app_server.py --no-sniff
}

docker() {
    uv run python ./scripts/container.py
}

cli() { # Show service status dashboard in terminal
    uv run python scripts/service_status_cli.py
}

test() {
    uv run python -m pytest tests/
}

kill_port() {
    lsof -ti:5000 | xargs kill -9 2>/dev/null || echo "No process running on port 5000"
}

pulumi_up() { # Deploy infrastructure using Pulumi
    cd infra && uv run pulumi up && cd ..
}